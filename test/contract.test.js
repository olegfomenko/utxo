const UTXO = artifacts.require("UTXO");
const EllipticCurve = artifacts.require("EllipticCurve");
const BigNumber = require("bignumber.js");
const { ethers } = require("hardhat");

describe("UTXO", () => {

  let lib;
  let libContract;
  let utxo;
  let utxoContract;

  // Private key: 0x13e4d2c57b16241a763047bf8f862ab630857592a18819f37b9b3c9e8567de65
  let key = {
    "_x": "15639559675625734025795989354902210429480226575270834412335467657634556514696",
    "_y": "13808122845547863717923179222109646155746415390670120415468336630118037023431"
  }
  let keyWitness = {
    "_r": {
      "_x": "4647945016766610320412477344006631128509887830145391045693063972743336143961",
      "_y": "2768426272188056247002295430844248209953159539586093251862926645074409220525"
    },
    "_s": "7560316378136231020841211442295372140678963564588656332438453137217475969138",
  };

  //Private key: 0x2a7aeda4f4473883c01b2075ada8977e2ba293bf302ee5684a01a360c235644b
  let proof = {"_e0":"15816177205726000138395950801158481104187821581466493287956199905145804706130","_c":[{"_x":"3471951853153194471236659622210178984842036563537462028293978327096682951589","_y":"16352954957784701760131261694648593890053759175685496680310144936003151569119"},{"_x":"2288793588000175809567318205587893912572096244194346514076395174153821529776","_y":"8245991774576868790906946505238969456510194017336744427383633353594258305070"},{"_x":"16215103147215800001773831002869378880701149223494930090829717572075560166473","_y":"4437537598819062393741368078855267976445503433571584374579525488438592491509"},{"_x":"10597437128509490167926700953494222402119678607808694812689800346795588814951","_y":"9190247249582772132743940390829809215974698927434687892191358089087183031461"},{"_x":"11326163931168644153534710496707216903710420153696298981520598001069170307054","_y":"9491169675030112578975094900050526640127319535362291005655778745930115356677"},{"_x":"14878038126945362754505130106929033294016240488124410645823474927473416615975","_y":"13725191193577371792663020685333327437702704382345782988466463534278724546777"},{"_x":"6862079092794045050596542203221874052416520869855909417469477584340231879707","_y":"5352911928317614726295092135014805128946604422708507858772184420047364052429"},{"_x":"12124206098095374411667604329206112465708986380603296233476725356585607669957","_y":"10120079147141559897553657999044979083562659987795658967932725042706764308196"},{"_x":"7740041970705476089569195160333247488048950740390112347230921179915556939872","_y":"21087552100394789113578901377952160469441719697538973274267067674058669845772"},{"_x":"13275318680163259720756812379671747501503897658816806027903210297176334793286","_y":"3364748810704522799294477306519519785351018887978430238987443326498277696231"},{"_x":"10606517853938020092082008733089564174440681616716131634285949725474802513841","_y":"9197716452850075118914126391058500378575932091173198550657861611254902192135"},{"_x":"4849613492326345726571635284367484034201855460865221528783202313368649885563","_y":"17955697193978228329812563053425672898792340962999501663268815168567199835543"},{"_x":"8787315118655328589873657558428069922689513560786318231837618735340377367241","_y":"2112831532688809613771241065830550557592187297081105661625708433157939967071"},{"_x":"4446977605356784969526001147886368155205426033035295827071265900175672793836","_y":"9818218530551418006720872671292234047187542972916277694178495465178851891651"},{"_x":"6811401193667495968053505991164393557069838749242371806364162335617054441478","_y":"18370351496194764044600906096769612884155788107286767095147995065861750189581"},{"_x":"14414459910433239282592180970054974187290316424629130599423487147904716630109","_y":"17197513920426053551577379199386914348409365766152117678441744392348508787595"},{"_x":"5785972172223827530351758771624560198935033654382319372055045619299260817844","_y":"6726868326249829448854131447084276006946651743052457203815545207061891290802"},{"_x":"11056600554467785542226416653372353300976275221484405806729706214303133621833","_y":"19119797078476063349166443338144908925162663303132929708776772599038900865352"},{"_x":"20817148477996725079129797966587317394712276479775381070760442251268354743078","_y":"2826184699828634041121436711511410984998156223860131724326659272142406051392"},{"_x":"19805489408484344717253542561219049874314574917592112499914444417426456685793","_y":"3476690241525509384510094638936546446163019801593943944063545710175216675180"},{"_x":"3171020631523971195862073853572167445886976519080665059318243164050619427679","_y":"3565102073848457834186579111060964650251509580582724929649755013680857147728"},{"_x":"1216098427072081388672063097895895912155788324457373936266744089293150036220","_y":"747806185930744076461972995074625678990725933199989190589684928857792371368"},{"_x":"18983164310357937000721396436815890137313327726875271221083893047124157022911","_y":"21737093032037958922563714230437069905182526336883689143332629632188062529128"},{"_x":"20355675005087557491219863050786125247398064071648071974433622975425623297887","_y":"19059647436356190414321463135801487544796007153169768340431147117583810555926"},{"_x":"3748271615514594413190339720479030352474558347593652301741679700471969857250","_y":"11104038200329558402724617745545555899328312471326848438190805339976833005087"},{"_x":"21033451581870590599254551679975467645937466388593952736157597144948432843621","_y":"12976164726010171467830218621416246211383721202074173590091006347317811272219"},{"_x":"7937996670908548662184442106218064377440910981796555305662600907053118479822","_y":"16294605910471011173075753477603671746517506260692520561842491194849247239437"},{"_x":"5695406873219517559315121195978970054410397645706619784022208364628403867168","_y":"14528281189839442423224500572582479619519299643760146386026186212020940980026"},{"_x":"3769534413287779081685774287988078808905122358111846768437394661166918913757","_y":"14014800990649059681426031524596026456422402102190546317311359144520425755164"},{"_x":"18600949176244496100874090642282686420697803229989087039776960394357380549336","_y":"14197797709273745401864613896914372242861737917475314693565866337290764879521"},{"_x":"422403009877197970545507735415225260543013638415781659820812647168521472808","_y":"5859989254924801001455458820535702982343865135996739226070157287237414052528"},{"_x":"10154421141847221770409418961551379833540823864802592238291495651304351111940","_y":"2724223080505917922958657193825865036154739021340296155821642397624659996565"},{"_x":"8357132666091451027958374236808061393993802525914313262069307136981451796374","_y":"5700989433365147918013020713285501181114442390285476260357788592393985904712"},{"_x":"4751079132387795192971063588064200792759516954486937767790893404407362412015","_y":"3428011492563894406840613534212397163536546149025410074598500437070777442779"},{"_x":"4903440944810296289530488081397472364397540922171689555113305381880837971383","_y":"21329359530585292152729848807143833701783686912091335004773691245629917847141"},{"_x":"16415144634045706606421688474710003395825416935674577125022963046489181737855","_y":"10919994337076862516306500981358609924978560647370087438522392936351408642650"},{"_x":"9792501251993926795621966155626866693508337554966072235843441568577371662683","_y":"7439225177953858538194386650295434202374986330532664334806375813686253438045"},{"_x":"17349989947315028030489181588232677937421424183810496600043118352137607904512","_y":"2312760611386852829731130563640783833952678813830979301610129919759902538723"},{"_x":"17530612212821793607763222876228934809630757234047383421469795975159612313100","_y":"17172384942554399463293345937186953184241345602614388417613482671374040066898"},{"_x":"20249470893432299734577956648961568105117018709467058798427063689249645355870","_y":"18274629489665407663484445551816460277705006757688708739901247047600162905677"},{"_x":"5552144870016597239068939128715047288724092931175097650748508533677094286383","_y":"365386080048781990754664860216743360383737159555455396437606808950297545729"},{"_x":"10408502463071754956158342629071902868576051721004251356182438182009282689124","_y":"2189957725447733427645182823128733483933596138142922623185155656992853091317"},{"_x":"2678772863842315973736256796758040857803359233870586410179452207590663099870","_y":"18016251810104354114084995343248699822593362455093152792257422649231804117757"},{"_x":"2429929785971796850591932473576662410876807129350266830255285926811743836456","_y":"7449493381239236751118576174756706908030921541799958792532299002780425345435"},{"_x":"18552899611782747238242577378886078417267919783334744282728839272330770830925","_y":"910163221154756128557831134274923556746556746498460033171545116995648414838"},{"_x":"2627798512503222465957447841452217728712966680187100157426976378383233789942","_y":"4881119468105060819333974411090776377409337093407241805108023360689874942513"},{"_x":"21674257917035979370971868211588220958953580667064229184698715484505068182763","_y":"12075263918004391191816236385454397289811353324219875207938448685943561944501"},{"_x":"19431761312434010514397626674308563052694812325323954236974692719513062213573","_y":"1700408404388297549830398807080505800018330697835539352475203852868470641780"},{"_x":"21465691467076358790576410638655568731923378324156831247777036031690244830095","_y":"265175943188987769798523114131065805059052571830318963687030468088739934376"},{"_x":"12216011273245518614568398427866541824044291461199413910082225955280687333172","_y":"19659009475064551369387482119112491008082933972317112452744855890275175305764"},{"_x":"3230022631503938346277061493099602102605212863637694876434375796037671730450","_y":"15379037540462608392994497248201172083211961504106214390836994427902692796028"},{"_x":"12388818801530388895754937408079640415466821676514856638142806147003855684085","_y":"20824256411786624617638945149020704524292529281707048265776638004994049903996"},{"_x":"9941448541211411118501648192711097557091642677533710687200488414079289789660","_y":"15316960780903413792146134623522518238718330690648387156686371685803665303051"},{"_x":"9327897149209087795613141123656743369793319521498245405127986579453694532971","_y":"10675222455075881438436039314145030993167379211390604168629357483372004033370"},{"_x":"17681915471220012048631520616019372615703135994746291004549889360718564725068","_y":"9053139475205582943073368086757946902770816942550113952419919851412682895659"},{"_x":"15792619288729757830635158958616941053369506645709751652565062582030735624478","_y":"19251771420119625747317768651772411295178870452191983696426612965893805200001"},{"_x":"3537247541241660548007907747891174189178719030687213325497647148784731769451","_y":"13224539003794668412464665106458212761971880397610842408468006548262375946681"},{"_x":"13132462962871627871335120854910678119385147961034986987886394440508094830793","_y":"13896427836526042850571503126935883579807096100361239474986171685206747011025"},{"_x":"12107958021300990674668183014977357739865875686816984846101101400459138152178","_y":"9508397005644380409182606048641369713131702304728897788676277849933850162380"},{"_x":"3398843167289239226424853248170445074979709892654920205674341828582510532285","_y":"13660525394664007176198361514441652358643551582272338990825374440988083107809"},{"_x":"2421624185782490682868082823647424184301089931640244790181905968353018838454","_y":"18690654252962297445154240086473766683844066093938094188106245699879576713161"},{"_x":"1395257730406862123674515865164217508905850805552571436089334756313008343672","_y":"18320424435608494771055285894271994728430284747438164975126675505158980422250"},{"_x":"8494973729615997879310449249024084938975577711342733828932407126489506492","_y":"2281914912253743591885236569080079255803202094479747836175426639789721201252"},{"_x":"21031451658480301259122872854290091863643818218312452552740153550695074786932","_y":"4453029115555351821798540255003546678849648348986345814553485594402790635210"},{"_x":"1742103962471874171304209762949784872420080626373691227064540224718792999753","_y":"719834327826642653310771975729872014788538594770900662902085990796966064407"},{"_x":"2900099315754684743775442787343383451311129387393032323381202508798688081678","_y":"8399430697050673211115897591114959666797409642917067764723233368794345334469"},{"_x":"15098890575151734254331135822516069853082603275627979136591033287244361083925","_y":"11336621064883443642802006799923884769795759706610461116583685243839272970925"},{"_x":"12595559245074577993164899569318384037399012934522323746304400654217071362995","_y":"15585405646244347947489030615496353847234380882201428375057572988212467164586"},{"_x":"71965638777719222479961685467968008694954362620377304986831462383550199311","_y":"6502439890748823080388989870824157327093469504303695509313885738261881421258"},{"_x":"6203895037579155471875675051301361588094901597329489817575751073956479027205","_y":"12417852376264504382459983689993748644336346987445550052103811281460676251200"},{"_x":"18353744945559396414210943036791832970229043094558524199812318943826497542700","_y":"11157850800778895151596457021305389660219763321330903572870777087998747807050"},{"_x":"7259696402591840882971018149985098852537610088142323484318164068772394166804","_y":"3452630604216403610297316392132585211737994322680302179482266428673029530927"},{"_x":"4703281614193087731845549555002181831119920259012282865607491609112888867974","_y":"7285368630933952901347549750444924259603569141267316608518461506835874321114"},{"_x":"8385454086955182536857440708619838008457105497852021312361748400753137801654","_y":"11381667279078965571933942475901066703920456868574443667240304874785968109832"},{"_x":"4260512282939581702173063541488581974840729226761407308295583176291366685532","_y":"17635688177664985979220542260195694115116460982556460173888781156893689959667"},{"_x":"8824640529271377986538008131449297468346319093357830040311055405858063447732","_y":"5236261207174202784570305968861832170472868649552085092532999724815775575705"},{"_x":"15457371922261012467436291384079628499761020355533882780912671209372301972856","_y":"19308657957738021655498118969661259171453714590727044066889870450904761978173"},{"_x":"11918865926457979022438347625266513655257015679671443898437263929610075431214","_y":"21886071349542450941450629688517543647050373961705659961277354505158881766244"},{"_x":"13418354090897816848664541347296943428429198436101643109700409178996218060217","_y":"8040712237996696336611956688809551151716253672975373377054980531695732149039"},{"_x":"5030206492096014210446936030161556931836285727979413864271859088276277226546","_y":"21336630660769056693720201944037308754012734280820823460069110208932706862967"},{"_x":"14774034043454589641064521242382283073155864259259671908093748106479910033286","_y":"650891701298734255131982315033576557468220170857079647228784869644306559898"},{"_x":"8384834389674024148094458802210582795278356829934137341386551287222397703680","_y":"8580529302834128371220267588844711605229141435572007282912910916013937159172"},{"_x":"14343388122233162185343069180914752148623651377852661847997536135928310832867","_y":"4211918345542895872405404137772990880432673370755683217327938165893631399458"},{"_x":"804212799992878564162824847955267890167641479345509474449534543269140009304","_y":"7714953035337809660941827514737597125425757650059948154828180949201301329594"},{"_x":"6650748093728710783615608646414062244832052096826021109751707972329121385676","_y":"15844850515425711285778508497265992704418281858400407984315702097705123613743"},{"_x":"17386696472729323455460576693252476092474075203807415195074217611587542673929","_y":"6418488897701389473519062415267655507783628491015200564711208689538790017484"},{"_x":"6246138676571977430141350286263643894835072115067785579656971135423689890170","_y":"9467342998857165963941518647209105383123398936921002806997785659432107825653"},{"_x":"4951905696112728316696186849319922790025908228718165227852836799281028646348","_y":"21257876165223849936689335991029215010180635338884397504713815361407405587121"},{"_x":"1739433044689607730935873548318127963629284785164266137616850423824094348316","_y":"1422005378375694139974499899310563037915127446414592015745498478544746264442"},{"_x":"17296698040489993344997432958769973071785574220808264437807814263771849284773","_y":"734359541199750073299599642925626265876612421793212763576243646505572055762"},{"_x":"12689091408231282591699249595684719802772624603721539598679262215196623171583","_y":"70406529551781538619647090764060290946737637700112883842930831029253182226"},{"_x":"13152571992744600958719541734998737426479187620424545336348142321219475693057","_y":"5257566657882673986817486395553230597421225487620891362066567095480914921440"},{"_x":"315378268303796734743106970656354529120700036794057085075105148341747164814","_y":"16131228975422750664782071547163587788835217625842133782897494198194906084859"},{"_x":"12608363564481862493854577724734669542792167829467440017026981275233481836409","_y":"18350887747399546963868001338830528019592627206712293041892406862959373837141"},{"_x":"11598572315712575420732030962650479548886846131971707042389717876124651524479","_y":"8718585194580913435249395633798312208388039041722894612317011118151600948371"},{"_x":"7963844268640918087611995798508408396635307462949543866061185053227855890896","_y":"12658069980097614745633372714195417699417157962769442302078422322996016155111"},{"_x":"4734671926372281710642667073595690335074464921332270668721496535567716453252","_y":"620117687558438736234331770512427033297609762436310405856613797023252666447"},{"_x":"14512603831549985940364087676811296719348355404564336962600899407791226030499","_y":"2780397245673635767700157114035972515855762936905160073492883780410024264109"},{"_x":"20719798002981995212003360493192640770969155891672031764942293401581302179245","_y":"20752152945726798677709366401437994737641456200925124092268822900881197353793"},{"_x":"6500043510045907706474598047349531697224522313428627977167081005823182982502","_y":"1373702684667429645746371088902311269524734785909411351698684624198718483007"},{"_x":"15956524530366532099820284223551307481243159675857462238757651037440517972978","_y":"2232608607317182550489004445614764569577785934454552908737437119342719731631"},{"_x":"5124632183042919762562700495490996120059821284815098535910657118545186029467","_y":"4490116364783637746760983983319945104343822398185754625982480812554428809475"},{"_x":"16598437323016230547521375238206233225830755870293501859674725879304715857624","_y":"12837732277215670177186062289468383121547273434861904597572731364344243591952"},{"_x":"2440691370210528675137365041026559167864880610229243879648751695745724646525","_y":"14161667867130800537364270410368545507450154499508239577396214335703776134929"},{"_x":"542399246256049559276090518572467202338630385062714593268477870866550883340","_y":"16903833268597775348040569691099498384789453490464634324177969320112137742598"},{"_x":"13094700133017110393602518038800219047752725503978728000353071037441468767930","_y":"5650386485305401079533445093555039450179330961072668218047104992438376691831"},{"_x":"2608377712432766332765485687021125833730252960454493020540070343559490331695","_y":"2448152847472569978164146762287724362568327077983713659287961624597099725050"},{"_x":"16881828688065799149998299338279395476703620288563502600583979057129494149869","_y":"6803327537225465973238344607770317929784864683948165830787945569298441968887"},{"_x":"18796251411367571570999871221648432595434064945550052288736867745021806550286","_y":"5453187076012783301935927425285940111898370393998286461847630575563818614629"},{"_x":"705884539511266300584280326361344360354533253186804384423476554882110384692","_y":"4310511164956486179200000514601720833983431522450042442352236167844187999334"},{"_x":"92450319055583268396511227308833962126989815729533915793795008818834657600","_y":"2411792228810271682306332124921903265557874456593281544083188649845677026338"},{"_x":"3409924020265361111804760641302653343363972545511513107279306303617802713274","_y":"17330446320254140382232333790431920702985457402985479219034912266382220377688"},{"_x":"18231371908352867947365052832634839109335984408069933071942246909632130092297","_y":"7060596715043371944115645331031176546058921910893997387674948222579844381831"},{"_x":"2468193169228222175413076149457016523023274470310290150910851001344553615399","_y":"3827050201590325634055845691562092776761255602427655369974081181835834605863"},{"_x":"21067327864252025796926460710700182027585334382672149783725351008163974206009","_y":"4004219253906006653278991280468829464894501216765392657278170236082379905006"},{"_x":"10077609833491547496414190501759237919000015037727408490716265050919794132780","_y":"7709335090770810986548717149354378297465301402540093657415340089494895164782"},{"_x":"1211310257277052750019803649506793772299109427217646313632189239855617925082","_y":"12555959059323917523344940385440369856016189998858363675690084872147673910619"},{"_x":"15951110679375121106981448001102766626350855387871802721704060875203102101932","_y":"5642211393041754379495978355523189529705533635626403582102082809677418478435"},{"_x":"5132335695434391645073148935061973777774287463032355214094334386163636587161","_y":"7882976684281154354657763352944226010219937977242477507374554169674960242315"},{"_x":"19487864369176640690927602292669504344272174208166419864850744944626106375780","_y":"4690606687921436784786434799644557016954914424730981309630588768301827788062"},{"_x":"13631416440434588348681060759797562962579939951308582324687202573323775628411","_y":"16925068284984645084159368136218985939178332790567281110745851456785375202115"},{"_x":"5411054582774499061836440028995160184358085875968025860931748691329088408875","_y":"11726367867790726855923328907622539787420336074789474650688221190186343772608"},{"_x":"18894700637509576990834496501155506853521564864400087969787578672287294543183","_y":"13082157406304185649053082977285922816797550072551705599280155481348690853784"},{"_x":"5864435572570791997220463438756369133328538398700801033615284391471297099901","_y":"9552991967861335656335509976877418087060856731759940193681762874790050902504"},{"_x":"3536241915194736012294371933128961933838889483749640025554821097713622321242","_y":"20844035798728578524068407204152090864074285478209448894811366444055693139946"},{"_x":"6916024607130336367128499263990294001330892902785593773115326550322671591038","_y":"14860581318308429290114002361284695796624426874740521403100710758020256101913"},{"_x":"5446998148338194730186290165906737915011709166906396795902592472052041016994","_y":"20303423380046939306390109880360120182331693524567472928416297391844796530772"},{"_x":"589692399789583944686261753346500267936507927471667954342460313901754308236","_y":"14149508727191835486476143250996343640394934452960611495602398808432517610447"}],"_s":["12002539904512796138074592844584466456164592670418459270132864565936772242442","11040521734652669439988388798562995095174608367729920521534106659583992002076","15418780510166046063749790605091609192491126999855651056515516085658414955231","4055005050810305722090902914082986911688108687467091230944250488643993231026","7695886153512415551718594579981890213087511465423878737655240723499084179150","17671360700117480911839531758856446015900121195292472104698973894594154930179","10560603871503119473188769661272810352928680253623149853513401993050240341043","16190298956276651036957173695059232341407393897303383517369242482575679198251","6722651409980198204949285929651955148627383681539481443581973782311550278962","16316395883594648435841159530382266755670011384522721160904690850929351466640","1005875939624748778345165764001183301587715568162923071382440098884850854238","1661597364423655364881424793103255052140241296181902841182403715226008181476","15498508878014516420415368107446570377340307397107866323842230377651164151054","7639807880992027410581940610278660382253145597829590892528452470034009518875","1056169859757178210295508434369292682022918438584536492247538578123217814983","12196877331917650223489659893529253001752505191695388101905925326334474784693","13189212924899506529229343918758291960854421332566113696097530412777426280704","4668011211878300171770722334196027567440854562043913847539024815874140869896","15443532942831431399903529979543123333661695793713651832634362817299795614022","281207102296427473362104171812087561513532910598882935824936489327255682526","9432352162801243608066235948070468240544328302650743822307236210425476818705","20927010448518781594501484083829688309270222052284178090487214085872142143873","5420360707131018859115238175845212756294894108817682491058616743258756427407","3812184358808256193621341157819404875534723137541862315516869208278888348877","20417472070629538083277192475235898218725529982848191541297206295023761074186","173848285722886163853083244844186995168707706338782512028043520085561757298","18962996182985228042117121903738927477642174368674856485130202665410409744498","16621457079677593719468767263946986977847654644590712529305938959632198058333","12421276903451286294257666561045197993114983923951201064239357469978410363803","17560899710879746822641498744081429764789892319644084233475527118861799376136","14656630142278454912067306545805901495026539336405272406973192724811467229482","6299577857200095192491687957145032976473658790917919422984737259572519155793","18270661203238501965982171821775001624718399426789499565091073185189699179981","18065969665933086923635846410994010118118458802248616240747360291321953328870","327242124864676131583723885441335879341152904839311508939739636411093748296","16385199248644726806680781208871625518083474197882085067369942275972180389339","9403308652199646214961329974475819500207280179400556734430941360670437225396","3208734804348925995700115675166630723897217920479654711812983667957715294951","6627725210664713089761000477538045917649507522971782900049424929576358392485","17716476692745834872667238782273264519564052870749262140436485719316593245363","13434868110567445520353242502282669093553823360480941817849485315079836296181","9060311819999000136679734154452261298171235073846790601889133547797466728732","20059560492423476982345905021868933879950649574075777717838292198030539104685","556220766852903597762499495144979044963429494061413318815861215493074799135","4222141259179859599600815506862623985400370520459330554639570290379493307740","8896772622551400780466427279386817135681767351737868448426577437529441969030","3765077751767929745073110010965063580268576364912767318505857563135768654777","10451447629509144750246663085819664974802369803182491790596149612710506547456","1572208013724437825781443616865446024761121955716330532464555886496682745481","134150260895557537628360565124895964455172044219592909931332137132338390823","747673631014267686495175877765555300124407692283154504914890592390044615087","18939670838348045437618226252299087482232883908658972345053944257157911908835","5681888263707673973520739496260394761749157812130691007086707950967344745119","13676680996539833923598523178852971696537350113997777556785997875169822560489","21179437843314002982001837536248921149226118497299266515932734309439249052259","19745577835277663468556314174690485635709894156885797502311384472151582540996","5726291898081602351806311660624223371217623839871237411488273675517355316969","11921721407592919892194438436091957804797827174955657924516333590561783012391","14878488413012048800694307503935660191046796562102848061975779590826059961342","790954220028545543812772798258242033214364588808912771438901466132213017862","12958437867338159421080153697131733937138734724355903597795090677245200995906","10010788187491389031991882678698015963699028718777624761283412426851514665990","17452382791465341085125845353639744604751570623501527116392942050126815347844","574405457723908284522372749515232900345835304524945974874043509644342545839","1286871213840294040929821468280528791409942199317114276045195270611617219812","7986002392306915774691621908669667084828849846146750445019174803244176559485","18619679848451325190346535138905977507676584609679551768113701274873397041095","14846113332653020719943731334137921297919278524494108639855128096603797659914","11862265621437072384015300298740688094580334734580655739536339081021524029679","1046673117506505677464752407022366930151795748060692257492689194304867504214","11790015382782137309407449587592795969421334773227063704462315575536769533245","4296626751181892188404911328972146344537661553001818289171065297482233949989","11990417133558955405849027228703235434175687970355760983069699671600866316764","4234001795984134681140446800172987624906879083632104040137839680970861329318","12860576966376131315370895695948288906650068379216798289680694113429610038201","17810521181611813815595575392083044008145169332659419749556869746600391338104","17209389224742180520907052172195129554092643288722618366656262502080097451224","11442958608290380769765973854495668814486892475328286867456076110757729411558","632650998201800057628346909878666249932836717929779728051673386293911993952","15846768323216809375808985310801634822663968269925867328181554499308110999941","2859116224143993602196459529612899992137522068257074835061684722819721776138","14397510298172902407190912643398534302739627029372682400189480046872884486995","5554666348640147034427214835757573332647077873425737479679309447207066781082","17845965208682584057971626350186875028128084948999712805245710847979401839572","4191469691163638601074444962690594883464801708914969165014387157475143468587","5531321379308032368050934719276113189452775402581465211617393445740110255217","20400021617634753259279235003294116888178832532226869040353407442624576694141","12133507765584461984948108147075746151281188523134061142897175363286630486448","13894418150112829494236455492693043288788878881826582946004434361910530781947","3073122830547023472496101981904785183140662352107567227933565819611665940683","12626173364256505113991200735289158114995334623811084639851945289012101193825","1981087210337001953495100718084158101850021021648435658093975160517986984806","2457455863502216151177405917547179127875459381108493178777657104576200482570","14468469803491781169321155567244823840311366681649020536951222082885464503966","8093865603334061195922574542695794600803491705815582670746637294586097706111","16994921826072560008687535497439101997518348628718100084167002178539021233689","1938317745894510585040239952529063057655393237601776012663708171395098434731","10266772728870866535095031538320421299804695562761537693135559353561234203298","10434691570264376462790179582235988609380882106361335905007484875160951426971","15900614100003643943489614498323115723568004867448069841251210236669051314329","15211303343876254456627101885254429879385466505899431007411821714264907702823","18696259266359665033341780249654356930779812915425639474931369147808397811583","12363406626334678673029684856131360776331099469692304085217203343348967070098","20092109288397491320101295496746892529060729917634484173456103733861983172902","17204979610260369132265665248433163870878014943921299485025576816416827511430","6683434082926171374845321010276980848498430599596959204642459568980324135039","3283851077144525826784106777156799960705880540151596630884021172858045920401","19306315658495238611223199342924810008715547565123389182253951067790847445016","3995007089705099670911888593928760916877201891325625084869067458534224444894","4022832056944232024608637731372938766835698479753202790584074301000084725150","12180915808407353851364074581753849501211514310777897334216668351800906249337","17531047649599969018651802458551547189835021264554898038301329879883466644766","7885700657554476062690604423483498536725268684154391508912327271745966313666","20080110911210538491632589870253989013483523719604709782613486029850715641395","20983469367975266353664282373883641763435928266456638314760341352107760422764","14869412382871068055261919836351797341205280617037102047227204479638643036028","15349621188157685545191586864864065818116367546497758501446848889565624296894","14210556792002830012588121575071900157459744439533819965163576007987150677094","4283694740379725135323455020652382287865938723061603097168980867054336055993","9858904661283924752811699693716697102602102626087553829039181013013578519120","1755325530528420965191372521857847281822205295822213107699521034053461714274","19196289047929226857594727107820189567650900410037348747560017979572222785489","7385678186142899961444370131533252160948256608831137109579763508158777483104","11710692325363149423297942385894663595898484996167297334081549114221195055085","9205324631511880165722645559083609669290529959328477555563956508714500004921","10567832935428278799912200433107114692460375666855738634697165526333421964356","112992840206892909136068719709611709973154527930588649597298623378563421734","7747236595802675991320660776898710978725524147297228223324546001824020178917"]};

  let commitment = {
    "_x": "7172771790548951396527864863358184765086953649672950404016109170052966065122",
    "_y": "15378786170436013690885012442013488640250995820194639844811147590249155297665"
  }

  beforeEach(async () => {
    lib = await ethers.getContractFactory("EllipticCurve");
    libContract = await lib.deploy();

    utxo = await ethers.getContractFactory("UTXO",
      {
        libraries: {
          EllipticCurve: libContract.address,
        }
      }
    );

    utxoContract = await utxo.deploy()
  });

  it("Deposit 100wei", async () => {
    await utxoContract.deposit(key, keyWitness, { value: "100" });
    await utxoContract.utxos(0);
  });

  it("Range proof", async () => {
    await utxoContract.verifyRangeProof(commitment, proof);
  });

  it("Initialize UTXO", async () => {
    await utxoContract.initialize(commitment, proof);
    await utxoContract.utxos(0);
  });

  it("Check witness", async () => {
    await utxoContract.verifyWitness(
      { "_x": "15639559675625734025795989354902210429480226575270834412335467657634556514696", "_y": "13808122845547863717923179222109646155746415390670120415468336630118037023431" },
      {
        "_r": { "_x": "5109730908197937793186988043505009936047779970479868047734172723071291139481", "_y": "5695537219841674439580460240695926440179084672260849397819152443008669244519" },
        "_s": "17334092223146687468005548295017179129455424012029209148307492557995637382354",
      },
      "0x2bdad7e530f187ef2cb15881f641bb9020c9b9ee163a934d4b49e7d916baadf9"
    )
  });

  it("Deposit & Withdraw", async () => {
    await utxoContract.deposit(key, keyWitness, { value: "100" });
    let u = await utxoContract.utxos(0);
    assert.equal(u._valuable, true);

    await utxoContract.withdraw(
      0,
      "0xF65F3f18D9087c4E35BAC5b9746492082e186872",
      100,
      {
        "_r": {
          "_x": "16027749843855789499543341052781208687691596897196959868735514864449663931922",
          "_y": "17200311890797201156272678535458899524730867745810239045062404967632337106280"
        },
        "_s": "6588726764565379866919810050369385337140705932980820912972156497528491442968",
      },
    )

    u = await utxoContract.utxos(0);
    assert.equal(u._valuable, false);
  });


  it("Deposit & Initialize & Transfer", async () => {
    await utxoContract.deposit(key, keyWitness, { value: "100" });
    await utxoContract.initialize(commitment, proof);

    let input = await utxoContract.utxos(0);
    assert.equal(input._valuable, true);

    let output = await utxoContract.utxos(1);
    assert.equal(output._valuable, false);

    await utxoContract.transfer([0], [1],
      {
        "_r": {
          "_x": "18863322224880889467330300443795512823867697830528975480296743509970544643670",
          "_y": "15238050434912729054994593464815643113082828699074916708077292599211520328479"
        },
        "_s": "2734646592366546712836682514399348553844124514411903952657683025480537816966",
      },
    );

    input = await utxoContract.utxos(0);
    assert.equal(input._valuable, false);

    output = await utxoContract.utxos(1);
    assert.equal(output._valuable, true);
  })

});